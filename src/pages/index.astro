---
// src/pages/index.astro

import type { HeroContent, BenefitItem, StatItem } from '@/types'
import BaseLayout from '@layouts/BaseLayout.astro'
import Header from '@components/layout/Header.astro'
import HeroSection from '@components/hero/HeroSection.astro'

const { getCollection } = await import('astro:content')

// ── Chargement des donnees Content Collections ─────────────

const heroEntries = await getCollection('hero')
const heroContent = heroEntries
  .map((entry: { data: unknown }) => entry.data as HeroContent)
  .find((h: HeroContent) => h.isActive !== false && h.locale === 'fr')

const benefitEntries = await getCollection('benefits')
const benefits = (benefitEntries
  .map((entry: { data: unknown }) => entry.data as BenefitItem)
  .filter((b: BenefitItem) => b.isActive !== false && b.locale === 'fr') as BenefitItem[])
  .sort((a: BenefitItem, b: BenefitItem) => a.order - b.order)

const statEntries = await getCollection('stats')
const stats = (statEntries
  .map((entry: { data: unknown }) => entry.data as StatItem)
  .filter((s: StatItem) => s.isActive !== false && s.locale === 'fr') as StatItem[])
  .sort((a: StatItem, b: StatItem) => a.order - b.order)

// ── Metadonnees SEO ────────────────────────────────────────

const DEFAULT_TITLE = 'AIAD - Framework de developpement avec agents IA'
const DEFAULT_DESCRIPTION =
  'AIAD : Le framework pour developper avec des agents IA'

const seoTitle = heroContent?.metadata?.seoTitle || DEFAULT_TITLE
const seoDescription =
  heroContent?.metadata?.seoDescription || DEFAULT_DESCRIPTION
---

<BaseLayout
  title={seoTitle}
  description={seoDescription}
  ogType="website"
>
  <Header />

  <main>
    <HeroSection
      heroContent={heroContent}
      benefits={benefits}
      stats={stats}
      background="gradient"
    />
  </main>
</BaseLayout>
